{
  "$schema": "https://struere.dev/schemas/policy/v1.json",
  "packId": "tutoring",
  "version": "1.0.0",
  "role": {
    "name": "guardian",
    "description": "Guardian access to their own students and related sessions",
    "isSystem": false,
    "linkedEntityType": "guardian"
  },
  "policies": [
    {
      "id": "guardian_own_profile",
      "description": "Guardians can read and update their own profile",
      "resource": "guardian",
      "actions": ["read", "update"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "field",
        "field": "id",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": []
    },
    {
      "id": "guardian_read_own_students",
      "description": "Guardians can read their own students",
      "resource": "student",
      "actions": ["read", "list"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "relation",
        "relationPath": "has_guardian",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": []
    },
    {
      "id": "guardian_read_student_sessions",
      "description": "Guardians can read sessions for their students",
      "resource": "session",
      "actions": ["read", "list"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "relation",
        "relationPath": "scheduled_for.has_guardian",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": []
    },
    {
      "id": "guardian_read_teachers_via_session",
      "description": "Guardians can read teachers for their students sessions (limited info)",
      "resource": "teacher",
      "actions": ["read"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "relation",
        "relationPath": "teaching_sessions.scheduled_for.has_guardian",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": [
        {
          "fieldPath": "phone",
          "maskType": "hide"
        },
        {
          "fieldPath": "hourlyRate",
          "maskType": "hide"
        },
        {
          "fieldPath": "availability",
          "maskType": "hide"
        }
      ]
    },
    {
      "id": "guardian_read_own_payments",
      "description": "Guardians can read their own payments",
      "resource": "payment",
      "actions": ["read", "list"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "relation",
        "relationPath": "paid_by",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": []
    },
    {
      "id": "guardian_read_own_entitlements",
      "description": "Guardians can read entitlements they purchased",
      "resource": "entitlement",
      "actions": ["read", "list"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "relation",
        "relationPath": "purchased_by",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": []
    },
    {
      "id": "guardian_deny_other_guardians",
      "description": "Guardians cannot see other guardians",
      "resource": "guardian",
      "actions": ["list"],
      "effect": "deny",
      "priority": 100,
      "scope": {
        "type": "field",
        "field": "id",
        "operator": "neq",
        "value": "$actor.linkedEntityId"
      }
    },
    {
      "id": "guardian_deny_create_entities",
      "description": "Guardians cannot create entities directly",
      "resource": "*",
      "actions": ["create", "delete"],
      "effect": "deny",
      "priority": 100
    }
  ],
  "capabilities": [
    "view_own_students",
    "view_student_sessions",
    "view_own_payments",
    "view_own_entitlements",
    "request_session_cancellation"
  ]
}
