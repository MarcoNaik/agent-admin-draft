{
  "$schema": "https://struere.dev/schemas/policy/v1.json",
  "packId": "tutoring",
  "version": "1.0.0",
  "role": {
    "name": "teacher",
    "description": "Teacher access to their own sessions and related students",
    "isSystem": false,
    "linkedEntityType": "teacher"
  },
  "policies": [
    {
      "id": "teacher_own_profile",
      "description": "Teachers can read and update their own profile",
      "resource": "teacher",
      "actions": ["read", "update"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "field",
        "field": "id",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": []
    },
    {
      "id": "teacher_list_own_sessions",
      "description": "Teachers can list their own sessions",
      "resource": "session",
      "actions": ["read", "list"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "relation",
        "relationPath": "taught_by",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": []
    },
    {
      "id": "teacher_update_own_sessions",
      "description": "Teachers can update feedback on their sessions",
      "resource": "session",
      "actions": ["update"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "relation",
        "relationPath": "taught_by",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "allowedFields": ["feedback", "notes"]
    },
    {
      "id": "teacher_read_students_via_session",
      "description": "Teachers can read students they teach (with masked contact info)",
      "resource": "student",
      "actions": ["read", "list"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "relation",
        "relationPath": "sessions.taught_by",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": [
        {
          "fieldPath": "phone",
          "maskType": "redact",
          "maskConfig": {
            "pattern": "***-***-****",
            "showLast": 0
          }
        },
        {
          "fieldPath": "email",
          "maskType": "redact",
          "maskConfig": {
            "pattern": "****@****",
            "preserveDomain": false
          }
        }
      ]
    },
    {
      "id": "teacher_read_guardians_via_student",
      "description": "Teachers can read guardians of their students (contact info hidden)",
      "resource": "guardian",
      "actions": ["read"],
      "effect": "allow",
      "priority": 50,
      "scope": {
        "type": "relation",
        "relationPath": "guardian_of.sessions.taught_by",
        "operator": "eq",
        "value": "$actor.linkedEntityId"
      },
      "fieldMasks": [
        {
          "fieldPath": "phone",
          "maskType": "hide"
        },
        {
          "fieldPath": "email",
          "maskType": "hide"
        }
      ]
    },
    {
      "id": "teacher_deny_payments",
      "description": "Teachers cannot see payment information",
      "resource": "payment",
      "actions": ["read", "list", "create", "update", "delete"],
      "effect": "deny",
      "priority": 100
    },
    {
      "id": "teacher_deny_entitlements",
      "description": "Teachers cannot see entitlement details",
      "resource": "entitlement",
      "actions": ["read", "list", "create", "update", "delete"],
      "effect": "deny",
      "priority": 100
    }
  ],
  "capabilities": [
    "view_own_schedule",
    "mark_session_complete",
    "add_session_feedback",
    "view_student_info"
  ]
}
